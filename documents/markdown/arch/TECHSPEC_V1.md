Hub Key Technical Specification V1
================================================

Table of Contents
=================

* [Introduction](#user-content-introduction)
* [Hub Key description](#user-content-hub-key-description)
  * [Examples](#user-content-examples)
* [Currently supported entity types](#user-content-currently-supported-entity-types)
* [Unicode](#user-content-unicode)

# Introduction

The Hub Key is a unique resource locator generated by the Open Permissions Platform to locate an entity. 
The Hub Key is generated during the onboarding process. 
A Hub Key is returned by the Onboarding API for each successfully onboarded entity such as Assets and Offers. 
Thereafter it can be used as a key to retrieve entities from Hub repositories and can also be used directly in the browser to return entities in human readable form.

Typically the Hub Key is written into the Asset metadata after the Asset is onboarded, providing a direct link from the Asset to information held in Hub repositories.

The Hub Key takes the form of a valid URL conforming to [RFC3986 section 3.3](http://tools.ietf.org/html/rfc3986#section-3.3). 

The remainder of this document is a specification of how the Hub Key is composed.

# Hub Key description

The Hub Key is composed from the following elements. Note that each segment **must** be valid as a URL path segment, as described below:

|Field|Description|Example|
|:---|:---|:---|
|**separator**|Use `/` as per specification below|`/`|
|**schema_version**|The version of the schema (this specification) that defines the key format|`s1`|
|**resolver_id**|The name of the host that can resolve the Hub Key. Must be a valid hostname and protocol |`https://copyrighthub.org`|
|**hub_id**|The id of the hub that is hosting the key|`hub1`|
|**entity_type**|The type of the entity to which the key refers. Hub Keys are used to uniquely identify different types of entities|See [Currently supported entity types](#user-content-currently-supported-entity-types)|
|**repository_id**|ID of the repository that contains the entity.|
|**entity_id**|The value of the entity as assigned by the Hub.|

A valid URL path segment consists of alpha numeric characters, the special characters `.-_~!$&'()*+,;=:@'`, or a percent encoded character. See [RFC3986 section 3.3](http://tools.ietf.org/html/rfc3986#section-3.3).

The Hub Key resolvable URL is composed from the Hub Key URI, with protocol and resolving host specified:

```
<resolver_id>/<schema_version>/<hub_id>/<repository_id>/<entity_type>/<entity_id>
```

## Examples

With these values:
* separator = `/`
* resolver_id = `https://copyrighthub.org`
* schema_version = `s1`
* hub_id = `chf`
* entity_type = `asset`
* repository_id = `14514543561346`
* entity_id = `104113451433373`

the following Hub Key resolvable URL is generated (shown non-URL encoded) identifying an Asset that was onboarded through `chf` to `copyrighthub.org`:
* https://copyrighthub.org/s1/chf/14514543561346/asset/104113451433373

Note that this is a valid URL which resolves to Asset data held by the Open Permissions Platform. 
For example, the URL can be pasted directly into a browser and navigated to.

* https://copyrighthub.org/s1/chf/1451451435345/asset/4514353134616
* https://copyrighthub.org/s1/chf/1451451435345/offer/2523452354315
* https://copyrighthub.org/s1/chf/1451451435345/agreement/1523267354315

The above Hub Keys show different entity types that exist in the same repository in the `chf` hub.
The same resolver is used for each entity, and in the Open Permissions Platform there will only be a single resolver available under their governance rules (at the time of writing).

* https://3dprinthub.com/s1/3d/4355451435346/asset/6678353134699
* https://3dprinthub.com/s1/3d/7657451439854/offer/5553452354987
* https://licensing.io/s1/3d/8261451435123/agreement/1523267354315

The above Hub Keys show different entity types that exist in different repositories available in the `3d` hub.
This hub allows multiple resolvers to operate and thus the owner of the creation can choose which site provides their entity resolution.

* https://abcd.com/s1/3d/4355451435346/asset/6678353134699
* https://abcd.com/s1/eu/8758587585858/asset/8765765786598

The above example shows Hub Keys from different hubs (`3d` and `eu`) being resolved by the same resolver.

# Currently supported entity types

The Hub Keys can be generated for a fix set of publicly exposed entities.

* **asset**
* **offer**
* **agreement**

# Unicode

The Hub Key **must not** contain Unicode characters, to ensure that it can be used as a valid URI.

Instead, when a Hub Key is generated the `resolver_id` is encoded using the Internationalized Domain Names in Applications (IDNA) ptotocol, see [RFC5891](https://www.ietf.org/rfc/rfc5891.txt). 
The remaining components are percent encoded, see [RFC3987](https://www.ietf.org/rfc/rfc3987.txt) and [RFC3490](https://www.ietf.org/rfc/rfc3490.txt).

<!-- Copyright Notice -->
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
